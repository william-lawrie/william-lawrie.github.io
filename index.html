<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h2 {
            margin-top: 0;
        }

        /* Top 3 columns */
        .columns {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-bottom: 30px;
        }

        .column {
            flex: 1;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        li {
            margin-bottom: 6px;
        }

        /* Tables */
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 25px;
        }

        th {
            background-color: #333;
            color: white;
            padding: 8px;
            text-align: left;
        }

        td {
            padding: 8px;
        }

        tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }

        tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Links */
        .jira-link {
            color: #0052cc;
            text-decoration: none;
            font-weight: bold;
        }

        .jira-link:hover {
            text-decoration: underline;
        }

        /* Collapsible sections */
        details {
            margin-bottom: 25px;
        }

        summary {
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }

        /* Floating search bubble */
        #floating-search-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        #floating-search-btn {
            background-color: #0052cc;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
        }

        #floating-search-input {
            display: none;
            position: absolute;
            bottom: 60px;
            right: 0;
            width: 250px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <!-- ===========================
            TOP FIXED 3 COLUMNS
    ============================ -->
    <div class="columns">

        <!-- TST -->
        <div class="column">
            <h2>TST</h2>
            <ul>
                <li><a href="tst-channel.html">TST Channel Widget - Channel Chat</a></li>
                <li><a href="tst-channel-brand-name.html">TST Channel Widget - Brand Name</a></li>
                <li><a href="tst-channel-queue-it.html">TST Channel Widget - Queue-it Enabled</a></li>
                <li><a href="tst-grid.html">TST Video Grid Widget</a></li>
                <li><a href="tst-single.html">TST Single Video Widget</a></li>
            </ul>
        </div>

        <!-- STG -->
        <div class="column">
            <h2>STG</h2>
            <ul>
                <li><a href="stg-channel.html">STG Channel Widget</a></li>
                <li><a href="stg-channel-queue-it.html">STG Channel Widget - Queue-it Enabled</a></li>
                <li><a href="stg-grid.html">STG Video Grid Widget</a></li>
                <li><a href="stg-single.html">STG Single Video Widget</a></li>
            </ul>
        </div>

        <!-- PROD -->
        <div class="column">
            <h2>Prod</h2>
            <ul>
                <li><a href="prod-channel-top-goals.html">Prod Channel Widget - Top Goals</a></li>
                <li><a href="prod-channel-william.html">Prod Channel Widget - William</a></li>
                <li><a href="prod-grid.html">Prod Video Grid Widget</a></li>
                <li><a href="prod-single.html">Prod Single Video Widget</a></li>
            </ul>
        </div>

    </div>

    <!-- ===================================
             DYNAMIC EPHEMERAL TABLE SECTIONS
    ==================================== -->
    <h2>Ephemeral Index</h2>
    <div id="ephemeral-sections"></div>

    <!-- Floating search -->
    <div id="floating-search-container">
        <button id="floating-search-btn">üîç</button>
        <input type="text" id="floating-search-input" placeholder="Search links...">
    </div>

    <script>
        // -----------------------------
        // Remaining links
        // -----------------------------
        const remainingLinks = [
            "9171-ephemeral-channel.html",
            "9171-ephemeral-grid.html",
            "9171-ephemeral-single.html",
            "9172-ephemeral-channel.html",
            "9172-ephemeral-grid.html",
            "9172-ephemeral-single.html",
            "9196-ephemeral-channel.html",
            "9196-ephemeral-grid.html",
            "9196-ephemeral-single.html",
            "9057-ephemeral-channel.html",
            "9057-ephemeral-grid.html",
            "9057-ephemeral-single.html",
            "7672-ephemeral-channel.html",
            "7672-ephemeral-grid.html",
            "7672-ephemeral-single.html",
            "9114-ephemeral.html",
            "7370-ephemeral.html",
            "9204-ephemeral.html",
            "9092-ephemeral.html",
            "9074-ephemeral.html",
            "8330-ephemeral.html",
            "6847-ephemeral.html",
            "9300-ephemeral.html",
            "9205-ephemeral.html",
            "9383-ephemeral.html",
            "9327-ephemeral.html",
            "9139-ephemeral.html",
            "9537-ephemeral-channel.html",
            "9537-ephemeral-grid.html",
            "9537-ephemeral-single.html",
            "martin-ephemeral.html",
            "9877-ephemeral-channel.html",
            "9160-ephemeral-channel.html",
            "9981-ephemeral-channel.html",
            "10128-ephemeral-channel.html",
            "10123-ephemeral-channel.html",
            "10202-ephemeral-channel.html",
            "9468-ephemeral-channel.html",
            "10286-ephemeral-channel.html",
            "10295-ephemeral-channel.html",
            "10297-ephemeral-channel.html",
            "10300-ephemeral-channel.html",
            "10334-ephemeral-channel.html",
            "10335-ephemeral-channel.html",
            "10344-ephemeral-channel.html",
            "10369-ephemeral-channel.html",
            "10386-ephemeral-channel.html",
            "10389-ephemeral-channel.html",
            "10401-ephemeral-channel.html",
            "10403-ephemeral-channel.html",
        ];

        // -----------------------------
        // Helpers
        // -----------------------------
        function getId(name) {
            const match = name.match(/^(\d+)/);
            return match ? parseInt(match[1], 10) : null;
        }

        function getType(name) {
            if (name.includes("channel")) return "Channel";
            if (name.includes("grid")) return "Grid";
            if (name.includes("single")) return "Single";
            return "Widget";
        }

        function getEnv(name) {
            if (name.includes("stg")) return "STG";
            if (name.includes("prod")) return "Prod";
            if (name.includes("tst")) return "TST";
            return "TST"; // default
        }

        // Partition numeric / non-numeric
        const numericLinks = remainingLinks
            .map(f => ({ file: f, id: getId(f) }))
            .filter(x => x.id !== null)
            .sort((a, b) => b.id - a.id);

        const nonNumericLinks = remainingLinks
            .filter(f => getId(f) === null)
            .sort();

        // Ranges
        const ranges = [
            { title: "10000+", min: 10000, max: Infinity },
            { title: "9000‚Äì9999", min: 9000, max: 9999 },
            { title: "8000‚Äì8999", min: 8000, max: 8999 },
            { title: "7000‚Äì7999", min: 7000, max: 7999 },
            { title: "6000‚Äì6999", min: 6000, max: 6999 }
        ];

        const container = document.getElementById("ephemeral-sections");

        function createTable(rows) {
            let html = "<table><thead><tr><th>ID</th><th>Environment</th><th>Type</th><th>Link</th></tr></thead><tbody>";
            rows.forEach(r => {
                html += `<tr>
<td><a class="jira-link" target="_blank" rel="noopener noreferrer" href="https://recastapp.atlassian.net/browse/DEV-${r.id}">DEV-${r.id}</a></td>
<td>${r.env}</td>
<td>${r.type}</td>
<td><a target="_blank" href="${r.file}">${r.file}</a></td>
</tr>`;
            });
            html += "</tbody></table>";
            return html;
        }

        ranges.forEach(range => {
            const rows = numericLinks
                .filter(x => x.id >= range.min && x.id <= range.max)
                .map(x => ({
                    id: x.id,
                    file: x.file,
                    type: getType(x.file),
                    env: getEnv(x.file)
                }));

            if (rows.length > 0) {
                container.innerHTML += `
<details open>
<summary>${range.title} (${rows.length})</summary>
${createTable(rows)}
</details>`;
            }
        });

        if (nonNumericLinks.length > 0) {
            const rows = nonNumericLinks.map(f => ({
                id: "",
                file: f,
                type: getType(f),
                env: getEnv(f)
            }));
            container.innerHTML += `
<details open>
<summary>Non-Numeric (${rows.length})</summary>
${createTable(rows)}
</details>`;
        }

        // -----------------------------
        // Floating search
        // -----------------------------
        const searchBtn = document.getElementById("floating-search-btn");
        const searchInput = document.getElementById("floating-search-input");

        searchBtn.addEventListener("click", () => {
            if (searchInput.style.display === "block") {
                searchInput.style.display = "none";
            } else {
                searchInput.style.display = "block";
                searchInput.focus();
            }
        });

        searchInput.addEventListener("input", function () {
            const term = this.value.toLowerCase();

            // Filter top list <li>
            document.querySelectorAll("li").forEach(li => {
                li.style.display = li.innerText.toLowerCase().includes(term) ? "" : "none";
            });

            // Filter table rows
            document.querySelectorAll("table tbody tr").forEach(tr => {
                const text = tr.innerText.toLowerCase();
                tr.style.display = text.includes(term) ? "" : "none";
            });
        });
    </script>

</body>

</html>