<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h2 {
            margin-top: 0;
        }

        /* Top 3 columns */
        .columns {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-bottom: 30px;
        }

        .column {
            flex: 1;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        li {
            margin-bottom: 6px;
        }

        /* Search bar */
        #search {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            background: #f3f3f3;
            text-align: left;
        }

        tr.hidden {
            display: none;
        }

        /* Collapsible sections */
        details {
            margin-bottom: 25px;
        }

        summary {
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <input type="text" id="search" placeholder="Search links...">

    <!-- ===========================
            TOP FIXED 3 COLUMNS
    ============================ -->
    <div class="columns">

        <!-- TST -->
        <div class="column">
            <h2>TST</h2>
            <ul>
                <li><a href="tst-channel.html">TST Channel Widget - Channel Chat</a></li>
                <li><a href="tst-channel-brand-name.html">TST Channel Widget - Brand Name</a></li>
                <li><a href="tst-channel-queue-it.html">TST Channel Widget - Queue-it Enabled</a></li>
                <li><a href="tst-grid.html">TST Video Grid Widget</a></li>
                <li><a href="tst-single.html">TST Single Video Widget</a></li>
            </ul>
        </div>

        <!-- STG -->
        <div class="column">
            <h2>STG</h2>
            <ul>
                <li><a href="stg-channel.html">STG Channel Widget</a></li>
                <li><a href="stg-channel-queue-it.html">STG Channel Widget - Queue-it Enabled</a></li>
                <li><a href="stg-grid.html">STG Video Grid Widget</a></li>
                <li><a href="stg-single.html">STG Single Video Widget</a></li>
            </ul>
        </div>

        <!-- PROD -->
        <div class="column">
            <h2>Prod</h2>
            <ul>
                <li><a href="prod-channel-top-goals.html">Prod Channel Widget - Top Goals</a></li>
                <li><a href="prod-channel-william.html">Prod Channel Widget - William</a></li>
                <li><a href="prod-grid.html">Prod Video Grid Widget</a></li>
                <li><a href="prod-single.html">Prod Single Video Widget</a></li>
            </ul>
        </div>

    </div>


    <!-- ===================================
             DYNAMIC EPHEMERAL TABLE SECTIONS
    ==================================== -->
    <h2>Ephemeral Index</h2>
    <div id="ephemeral-sections"></div>


    <script>
        // -----------------------------
        // Your full list of remaining links
        // -----------------------------
        const remainingLinks = [
            "9171-ephemeral-channel.html",
            "9171-ephemeral-grid.html",
            "9171-ephemeral-single.html",
            "9172-ephemeral-channel.html",
            "9172-ephemeral-grid.html",
            "9172-ephemeral-single.html",
            "9196-ephemeral-channel.html",
            "9196-ephemeral-grid.html",
            "9196-ephemeral-single.html",
            "9057-ephemeral-channel.html",
            "9057-ephemeral-grid.html",
            "9057-ephemeral-single.html",
            "7672-ephemeral-channel.html",
            "7672-ephemeral-grid.html",
            "7672-ephemeral-single.html",
            "9114-ephemeral.html",
            "7370-ephemeral.html",
            "9204-ephemeral.html",
            "9092-ephemeral.html",
            "9074-ephemeral.html",
            "8330-ephemeral.html",
            "6847-ephemeral.html",
            "9300-ephemeral.html",
            "9205-ephemeral.html",
            "9383-ephemeral.html",
            "9327-ephemeral.html",
            "9139-ephemeral.html",
            "9537-ephemeral-channel.html",
            "9537-ephemeral-grid.html",
            "9537-ephemeral-single.html",
            "martin-ephemeral.html",
            "9877-ephemeral-channel.html",
            "9160-ephemeral-channel.html",
            "9981-ephemeral-channel.html",
            "10128-ephemeral-channel.html",
            "10123-ephemeral-channel.html",
            "10202-ephemeral-channel.html",
            "9468-ephemeral-channel.html",
            "10286-ephemeral-channel.html",
            "10295-ephemeral-channel.html",
            "10297-ephemeral-channel.html",
            "10300-ephemeral-channel.html",
            "10334-ephemeral-channel.html",
            "10335-ephemeral-channel.html"
        ];

        // Helper: get numeric ID or null
        function getId(name) {
            const match = name.match(/^(\d+)/);
            return match ? parseInt(match[1], 10) : null;
        }

        // Helper: detect type
        function getType(name) {
            if (name.includes("channel")) return "Channel";
            if (name.includes("grid")) return "Grid";
            if (name.includes("single")) return "Single";
            return "Widget";
        }

        // Helper: detect environment
        function getEnv(name) {
            if (name.includes("stg")) return "STG";
            if (name.includes("prod")) return "Prod";
            if (name.includes("tst")) return "TST";
            return "TST"; // Default for ephemeral
        }

        // Partition numeric + non-numeric
        const numericLinks = remainingLinks
            .map(file => ({ file, id: getId(file) }))
            .filter(x => x.id !== null)
            .sort((a, b) => b.id - a.id);

        const nonNumericLinks = remainingLinks
            .filter(file => getId(file) === null)
            .sort();


        // Build grouped sections
        const ranges = [
            { title: "10000+", min: 10000, max: Infinity },
            { title: "9000–9999", min: 9000, max: 9999 },
            { title: "8000–8999", min: 8000, max: 8999 },
            { title: "7000–7999", min: 7000, max: 7999 },
            { title: "6000–6999", min: 6000, max: 6999 }
        ];

        const container = document.getElementById("ephemeral-sections");

        function createTable(rows) {
            let html = "<table><tr><th>ID</th><th>Environment</th><th>Type</th><th>Link</th></tr>";
            rows.forEach(r => {
                html += `<tr><td>${r.id}</td><td>${r.env}</td><td>${r.type}</td><td><a href="${r.file}">${r.file}</a></td></tr>`;
            });
            html += "</table>";
            return html;
        }

        // Render numeric sections
        ranges.forEach(range => {
            const rows = numericLinks
                .filter(x => x.id >= range.min && x.id <= range.max)
                .map(x => ({
                    id: x.id,
                    file: x.file,
                    type: getType(x.file),
                    env: getEnv(x.file)
                }));

            if (rows.length > 0) {
                container.innerHTML += `
                    <details open>
                        <summary>${range.title} (${rows.length})</summary>
                        ${createTable(rows)}
                    </details>
                `;
            }
        });

        // Non-numeric section
        if (nonNumericLinks.length > 0) {
            let rows = nonNumericLinks.map(file => ({
                id: "",
                file,
                type: getType(file),
                env: getEnv(file)
            }));

            container.innerHTML += `
                <details open>
                    <summary>Non-Numeric (${rows.length})</summary>
                    ${createTable(rows)}
                </details>
            `;
        }

        // ---------------------------------
        // Search/filter across EVERYTHING
        // ---------------------------------
        document.getElementById("search").addEventListener("input", function () {
            const term = this.value.toLowerCase();

            // Filter top list <li> items
            document.querySelectorAll("li").forEach(li => {
                li.style.display = li.innerText.toLowerCase().includes(term) ? "" : "none";
            });

            // Filter table rows
            document.querySelectorAll("table tr").forEach((tr, idx) => {
                if (idx === 0) return; // skip header
                const text = tr.innerText.toLowerCase();
                tr.classList.toggle("hidden", !text.includes(term));
            });
        });
    </script>

</body>

</html>
